if($ENV{USE_PROTOBUF_LITE})
   MESSAGE(STATUS "Using protobuf-lite")
else()
   MESSAGE(STATUS "Not using protobuf-lite")
endif()
if($ENV{USING_SSL})
   MESSAGE(STATUS "Using SSL")
else()
   MESSAGE(STATUS "Not using SSL")
endif()

if (UNIX)
   # Note: The order of adding parameters to the CMAKE_CXX_FLAGS here is important.
   SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g -Wall")
   include(CheckCXXCompilerFlag)
   CHECK_CXX_COMPILER_FLAG("-std=c++11" COMPILER_SUPPORTS_CXX11)
   CHECK_CXX_COMPILER_FLAG("-std=c++0x" COMPILER_SUPPORTS_CXX0X)
   if(COMPILER_SUPPORTS_CXX11)
      SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
   elseif(COMPILER_SUPPORTS_CXX0X)
      SET(COMPILER_SUPPORTS_CXX11, FALSE)
      SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x")
   else()
      MESSAGE(STATUS "The compiler ${CMAKE_CXX_COMPILER} has no C++11 support. Please use a different C++ compiler.")
   endif()
   SET(OBJCOPY "$ENV{CROSS_COMPILE_FULL}objcopy")
elseif(MSVC)
   # Windows compiler flags for all projects.
   SET(COMPILER_SUPPORTS_CXX11, TRUE)

   #set compiler flags for all projects and all targets
   #use ADD_DEFINITIONS to change compiler options for individual projects (see MessageDefs project for example)
   # Ignore the warning about __forceinline functions not inlined (/wd4717).  Boost and MSVC don't get along with respect to this warning.
   # Ignore the warning about performance of convertsions to bool (/wd4800).  MVSC doesn't understand bool as a C++ basic scalar type.
   set(CMAKE_CXX_FLAGS "/DWIN32 /D_WINDOWS /GR /GS /W4 /wd4714 /wd4800 /Gy /Zc:wchar_t /Zi /Gm /O2 /sdl /Zc:inline /fp:precise /errorReport:prompt /WX- /Zc:forScope /Gd /Oi /MD /EHsc /nologo /sdl-")

   #add debug specific flags here
   set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG}")
   #add release specific flags here
   SET(MSWIN_LINK_FLAGS_RELEASE "/debug")
   
endif()
#added D_WIN32_WINNT=0x0601 because of a boost warning.  Not really sure if this is what we should be doing
ADD_DEFINITIONS(-DPROTOBUF_USE_DLLS -DBOOST_ALL_DYN_LINK -DBOOST_ALL_NO_LIB -DBOOST_LIB_DIAGNOSTIC -D_WIN32_WINNT=0x0601)
if($ENV{USING_SSL})
   ADD_DEFINITIONS(-DUSING_SSL)
endif()

# Found that -DBOOST_ALL_DYN_LINK doesn't work for some Linux VMs and looks for static Boost libraries.
# This seems to fix it.
if("LinuxHost" MATCHES $ENV{TARGET_NAME})
   set(Boost_USE_STATIC_LIBS        OFF)
   set(Boost_USE_MULTITHREADED      ON)
   set(Boost_USE_STATIC_RUNTIME     OFF)
   set(BOOST_ALL_DYN_LINK           ON)   # force dynamic linking for all libraries
   #These can be used to display diagnostic info
   #set(Boost_DEBUG ON)
   #set(BOOST_LIBRARYDIR "$ENV{COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release")
   #find_package(Boost 1.68.0 COMPONENTS filesystem log system)
endif()

# Platform independent path separator.
SET(COMMON_SRC_HOME "$ENV{COMMON_SRC_HOME}")
SET(COMMON_WORKSPACE "$ENV{COMMON_WORKSPACE}")
SET(COMMON_PRODUCT_HOME "$ENV{COMMON_PRODUCT_HOME}")
SET(COMMON_TEST_HOME "$ENV{COMMON_TEST_HOME}")
SET(COMMON_THIRDPARTY_HOME "$ENV{COMMON_THIRDPARTY_HOME}")
SET(COMMON_THIRDPARTY_LIB_PATH_RELEASE "$ENV{COMMON_THIRDPARTY_LIB_PATH_RELEASE}")
SET(COMMON_THIRDPARTY_LIB_PATH_DEBUG "$ENV{COMMON_THIRDPARTY_LIB_PATH_DEBUG}")

if (MSVC)
   SET(COMMON_BOOST_HOME "$ENV{ProgramW6432}/boost/boost_1_68_0")
   STRING(REGEX REPLACE "\\\\" "/" COMMON_BOOST_HOME ${COMMON_BOOST_HOME})
   STRING(REGEX REPLACE "\\\\" "/" COMMON_PRODUCT_HOME ${COMMON_PRODUCT_HOME})
   STRING(REGEX REPLACE "\\\\" "/" COMMON_TEST_HOME ${COMMON_TEST_HOME})
   STRING(REGEX REPLACE "\\\\" "/" COMMON_THIRDPARTY_HOME ${COMMON_THIRDPARTY_HOME})
   STRING(REGEX REPLACE "\\\\" "/" COMMON_THIRDPARTY_LIB_PATH_RELEASE ${COMMON_THIRDPARTY_LIB_PATH_RELEASE})
   STRING(REGEX REPLACE "\\\\" "/" COMMON_THIRDPARTY_LIB_PATH_DEBUG ${COMMON_THIRDPARTY_LIB_PATH_DEBUG})

   # Treat the Boost include headers as a system resource.
   INCLUDE_DIRECTORIES(SYSTEM "${COMMON_BOOST_HOME}")

   SET(WIN_THIRDPARTY_HOME "$ENV{COMMON_THIRDPARTY_HOME}")
   SET(WIN_THIRDPARTY_DEBUG_LIB_DIR "$ENV{COMMON_THIRDPARTY_HOME}\\lib\\WinHost\\Debug")
   SET(WIN_THIRDPARTY_RELEASE_LIB_DIR "$ENV{COMMON_THIRDPARTY_HOME}\\lib\\WinHost\\Release")

   SET(WIN_COMMON_RUNTIME_OUTPUT_RELEASE_DIR "$ENV{COMMON_RELEASE_OUT_HOME}" )
   SET(WIN_COMMON_RUNTIME_OUTPUT_DEBUG_DIR "$ENV{COMMON_DEBUG_OUT_HOME}" )
   #SET(WIN_COMMON_RUNTIME_OUTPUT_RELWITHDEB_DIR "$ENV{COMMON_RELEASEWITHDEB_OUT_HOME}" )
   
   if($ENV{USE_PROTOBUF_LITE})
      FIND_LIBRARY(PROTOBUF_DEBUG_LIB libprotobuf-lited ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
      FIND_LIBRARY(PROTOBUF_RELEASE_LIB libprotobuf-lite ${COMMON_THIRDPARTY_LIB_PATH_RELEASE} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
   else()
      FIND_LIBRARY(PROTOBUF_DEBUG_LIB libprotobufd ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
      FIND_LIBRARY(PROTOBUF_RELEASE_LIB libprotobuf ${COMMON_THIRDPARTY_LIB_PATH_RELEASE} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
   endif()

   IF($ENV{USING_SSL})
      FIND_LIBRARY(SSLCRYPTO_DEBUG_LIB libcrypto32MDd ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
      FIND_LIBRARY(SSLCRYPTO_RELEASE_LIB libcrypto32MD ${COMMON_THIRDPARTY_LIB_PATH_RELEASE} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)

      FIND_LIBRARY(OPENSSL_DEBUG_LIB libssl32MDd ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
      FIND_LIBRARY(OPENSSL_RELEASE_LIB libssl32MD ${COMMON_THIRDPARTY_LIB_PATH_RELEASE} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
   endif()
   
   FIND_LIBRARY(GTEST_DEBUG_LIB gtest ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(GMOCK_DEBUG_LIB gmock ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)

   FIND_LIBRARY(BOOST_DATE_TIME_DEBUG_LIB boost_date_time-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_REGEX_DEBUG_LIB boost_regex-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_SYSTEM_DEBUG_LIB boost_system-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_ATOMIC_DEBUG_LIB boost_atomic-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_CHRONO_DEBUG_LIB boost_chrono-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_LOG_DEBUG_LIB boost_log-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_LOG_SETUP_DEBUG_LIB boost_log_setup-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_FILESYSTEM_DEBUG_LIB boost_filesystem-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_THREAD_DEBUG_LIB boost_thread-vc141-mt-gd-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Debug/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)

   FIND_LIBRARY(BOOST_DATE_TIME_RELEASE_LIB boost_date_time-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_REGEX_RELEASE_LIB boost_regex-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_SYSTEM_RELEASE_LIB boost_system-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_ATOMIC_RELEASE_LIB boost_atomic-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_CHRONO_RELEASE_LIB boost_chrono-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_LOG_RELEASE_LIB boost_log-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_LOG_SETUP_RELEASE_LIB boost_log_setup-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_FILESYSTEM_RELEASE_LIB boost_filesystem-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)
   FIND_LIBRARY(BOOST_THREAD_RELEASE_LIB boost_thread-vc141-mt-x32-1_68 ${COMMON_THIRDPARTY_HOME}/lib/$ENV{TARGET_NAME}/Release/ NO_DEFAULT_PATH
      NO_CMAKE_FIND_ROOT_PATH)

#LINUX
else() 
    # Don't have debug libraries for Linux, make them the same as release
	if($ENV{USE_PROTOBUF_LITE})
		FIND_LIBRARY(PROTOBUF_RELEASE_LIB        libprotobuf-lite.so     ${COMMON_THIRDPARTY_LIB_PATH_RELEASE}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
		FIND_LIBRARY(PROTOBUF_DEBUG_LIB          libprotobuf-lite.so     ${COMMON_THIRDPARTY_LIB_PATH_DEBUG}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	else()
		FIND_LIBRARY(PROTOBUF_RELEASE_LIB         libprotobuf.so          ${COMMON_THIRDPARTY_LIB_PATH_RELEASE}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
		FIND_LIBRARY(PROTOBUF_DEBUG_LIB           libprotobuf.so          ${COMMON_THIRDPARTY_LIB_PATH_DEBUG}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	endif()
	
    IF($ENV{USING_SSL})
        FIND_LIBRARY(SSLCRYPTO_DEBUG_LIB libcrypto.so ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
        FIND_LIBRARY(SSLCRYPTO_RELEASE_LIB libcrypto.so ${COMMON_THIRDPARTY_LIB_PATH_RELEASE} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
        
        FIND_LIBRARY(OPENSSL_DEBUG_LIB libssl.so ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
        FIND_LIBRARY(OPENSSL_RELEASE_LIB libssl.so ${COMMON_THIRDPARTY_LIB_PATH_RELEASE} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
    endif()
    FIND_LIBRARY(GTEST_DEBUG_LIB gtest ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
    FIND_LIBRARY(GMOCK_DEBUG_LIB gmock ${COMMON_THIRDPARTY_LIB_PATH_DEBUG} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)

	FIND_LIBRARY(BOOST_DATE_TIME_DEBUG_LIB    libboost_date_time.so   ${COMMON_THIRDPARTY_LIB_PATH_DEBUG}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	FIND_LIBRARY(BOOST_REGEX_DEBUG_LIB        libboost_regex.so       ${COMMON_THIRDPARTY_LIB_PATH_DEBUG}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	FIND_LIBRARY(BOOST_SYSTEM_DEBUG_LIB       libboost_system.so      ${COMMON_THIRDPARTY_LIB_PATH_DEBUG}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	FIND_LIBRARY(BOOST_LOG_DEBUG_LIB          libboost_log.so         ${COMMON_THIRDPARTY_LIB_PATH_DEBUG}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	FIND_LIBRARY(BOOST_FILESYSTEM_DEBUG_LIB   libboost_filesystem.so  ${COMMON_THIRDPARTY_LIB_PATH_DEBUG}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)

	FIND_LIBRARY(BOOST_DATE_TIME_RELEASE_LIB  libboost_date_time.so   ${COMMON_THIRDPARTY_LIB_PATH_RELEASE}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	FIND_LIBRARY(BOOST_REGEX_RELEASE_LIB      libboost_regex.so       ${COMMON_THIRDPARTY_LIB_PATH_RELEASE}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	FIND_LIBRARY(BOOST_SYSTEM_RELEASE_LIB     libboost_system.so      ${COMMON_THIRDPARTY_LIB_PATH_RELEASE}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	FIND_LIBRARY(BOOST_LOG_RELEASE_LIB        libboost_log.so         ${COMMON_THIRDPARTY_LIB_PATH_RELEASE}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
	FIND_LIBRARY(BOOST_FILESYSTEM_RELEASE_LIB libboost_filesystem.so  ${COMMON_THIRDPARTY_LIB_PATH_RELEASE}  NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
endif ()

FIND_LIBRARY(GTEST_RELEASE_LIB gtest ${COMMON_THIRDPARTY_LIB_PATH_RELEASE} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
FIND_LIBRARY(GMOCK_RELEASE_LIB gmock ${COMMON_THIRDPARTY_LIB_PATH_RELEASE} NO_DEFAULT_PATH NO_CMAKE_FIND_ROOT_PATH)
