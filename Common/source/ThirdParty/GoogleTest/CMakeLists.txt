# cmake file for building the GoogleTest libraries.
SET(CUR_PROJECT_NAME gtest)
SET(GOOGLETEST_HOME "${COMMON_THIRDPARTY_HOME}/GoogleTest")
# First for the generic no-config case
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY $ENV{COMMON_TEST_EXEC_HOME})
SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY $ENV{COMMON_TEST_EXEC_HOME} )
SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY $ENV{COMMON_TEST_EXEC_HOME}/lib )
SET(CMAKE_PDB_OUTPUT_DIRECTORY "$ENV{COMMON_TEST_EXEC_HOME}")

# Second, for multi-config builds (e.g. msvc)
FOREACH( OUTPUTCONFIG ${CMAKE_CONFIGURATION_TYPES} )
    STRING( TOUPPER ${OUTPUTCONFIG} U_OUTPUTCONFIG )
    SET( CMAKE_RUNTIME_OUTPUT_DIRECTORY_${U_OUTPUTCONFIG} $ENV{COMMON_TEST_EXEC_HOME} )
    SET( CMAKE_LIBRARY_OUTPUT_DIRECTORY_${U_OUTPUTCONFIG} $ENV{COMMON_TEST_EXEC_HOME} )
    SET( CMAKE_ARCHIVE_OUTPUT_DIRECTORY_${U_OUTPUTCONFIG} $ENV{COMMON_TEST_EXEC_HOME}/lib )
    SET( CMAKE_PDB_OUTPUT_DIRECTORY_${U_OUTPUTCONFIG} "$ENV{COMMON_TEST_EXEC_HOME}" )
ENDFOREACH( OUTPUTCONFIG CMAKE_CONFIGURATION_TYPES )

INCLUDE_DIRECTORIES("${GOOGLETEST_HOME}" "${GOOGLETEST_HOME}/include")
FILE(GLOB GOOGLETEST_LIB "${GOOGLETEST_HOME}/src/gtest-all.cc")
if(UNIX)
   SET(GOOGLETEST_COMPILE_FLAG "-Wextra -pthread")
   SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${GOOGLETEST_COMPILE_FLAG}")
endif()


ADD_LIBRARY(${CUR_PROJECT_NAME} STATIC ${GOOGLETEST_LIB})

# Set Windows-specific compiler flags.
if(MSVC)
   SET(USER_FILE "${CMAKE_CURRENT_BINARY_DIR}/${CUR_PROJECT_NAME}.vcxproj.user")
   if(NOT EXISTS "${USER_FILE}")
      CONFIGURE_FILE($ENV{COMMON_SOURCE_HOME}//project.vcxproj.user.in ${USER_FILE} @ONLY)
   endif()
   ADD_DEFINITIONS(-DUNICODE -D_UNICODE)
endif()
